name: Build and Deploy3

on: [push] # workflow를 실행시킬 브런치와 요청(push, pull request)
  # pull_request:
  #   branches:
  #     - dev

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
        
    - name: Set up Node.js with dotenv
      uses: actions/setup-node@v3
      with:
          node-version: 14
          clean: true
          with-dotenv: true

          
    - name: Install Dependencies
      run: npm install
      # echo "REACT_APP_API_KEY=${{ secrets.REACT_APP_API_KEY }}" >> $GITHUB_ENV
      # echo "REACT_APP_ACTION_TEXT=${{ secrets.REACT_APP_ACTION_TEXT }}" >> $GITHUB_ENV
    - name: Set Environment Variable for React App
      run: | 
        echo "REACT_APP_API_KEY=${{ secrets.REACT_APP_API_KEY }}" >> .env
        echo "REACT_APP_ACTION_TEXT=${{ secrets.REACT_APP_ACTION_TEXT }}" >> .env
        
    - name: Build React App
      run: npm run build
      env:
        CI: "" #경고를 에러로 보지 않게 함

    - name: Debug Secret Value
      run: |
        echo "REACT_APP_API_KEY: ${{ secrets.REACT_APP_API_KEY }}"
        echo "REACT_APP_ACTION_TEXT: ${{ secrets.REACT_APP_ACTION_TEXT }}"

        

  deploy:
                runs-on: ubuntu-latest
                needs: build
                steps:
                  - name: Checkout Repository
                    uses: actions/checkout@v2
              
                  - name: Set up Node.js with dotenv
                    uses: actions/setup-node@v3
                    with:
                        node-version: 14
                        clean: true
                        with-dotenv: true
              
                  - name: Install Netlify CLI
                    run: npm install -g netlify-cli
              
                  - name: Deploy to Netlify
                    run: |
                      npm install
                      npm run build
                      netlify deploy --prod --dir=build
                    env:
                      CI: "" # 경고를 에러로 보지 않게 함
                      REACT_APP_API_KEY: ${{ secrets.REACT_APP_API_KEY }}
                      REACT_APP_ACTION_TEXT: ${{ secrets.REACT_APP_ACTION_TEXT }}
                      NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}





#   deploy:
#     runs-on: ubuntu-latest
#     needs: build
#     steps:
#     - name: Checkout Repository
#       uses: actions/checkout@v2

#     - name: Set up Node.js
#       uses: actions/setup-node@v3
#       with:
#         node-version: 14

#     - name: Deploy to Hosting
#       run: |
#         npm install
#         npm run build
#       env:
#         CI: "" #경고를 에러로 보지 않게 함
#         REACT_APP_API_KEY: ${{ secrets.REACT_APP_API_KEY }}
#         REACT_APP_ACTION_TEXT: ${{ secrets.REACT_APP_ACTION_TEXT }}
#         # 여기에 실제 배포 스크립트 작성

